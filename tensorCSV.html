<!DOCTYPE html>
<html>
<head>
    <title>Your Page</title>
    <!-- เรียกใช้ TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
</head>
<body>

    <!-- สร้าง input สำหรับอัปโหลดไฟล์ CSV -->
    <input type="file" id="csvFileInput" accept=".csv" />
    

    <script>
        // ฟังก์ชันสำหรับแสดงผลลัพธ์
        function displayResult(result) {
            const resultElement = document.getElementById('result');
            if (resultElement) {
                resultElement.innerHTML = result;
            } else {
                console.error("Element with id 'result' not found.");
            }
        }

        // ฟังก์ชันสำหรับอ่านไฟล์ CSV และเตรียมข้อมูล
        async function processCSV() {
            // อ่านไฟล์ CSV จาก input
            const fileInput = document.getElementById('csvFileInput');
            const file = fileInput.files[0];
            const text = await file.text();

            // แปลงข้อมูล CSV เป็น array ของ objects
            const csvArray = text.split('\n').map(row => row.split(','));
            const header = csvArray[0];
            const data = csvArray.slice(1).map(row => {
                const rowData = {};
                header.forEach((headerItem, index) => {
                    rowData[headerItem] = parseFloat(row[index]);
                });
                return rowData;
            });

            // เลือกและแปลงข้อมูลที่คุณสนใจ
            const selectedData = data.map(row => ({
                Date: row.Date,
                Month: row.Month,
                Year: row.Year,
                jackpot: row.jackpot,
                "2 bottom": row["2 bottom"],
                "3 front 1": row["3 front 1"],
                "3 front 2": row["3 front 2"],
                "3 bottom 1": row["3 bottom 1"],
                "3 bottom 2": row["3 bottom 2"]
            }));

            // เตรียมข้อมูลให้อยู่ในรูปแบบ Tensor
            const xTrain1 = tf.tensor2d(selectedData.map(row => [
                row["2 bottom"],
                row["3 front 1"],
                row["3 front 2"]
            ]));

            const yTrain1 = tf.tensor2d(selectedData.map(row => [
                row.Date,
                row.Month,
                row.Year
            ]));

            const xTrain2 = tf.tensor2d(selectedData.map(row => [
                row["3 front 1"],
                row["3 front 2"],
                row["3 bottom 1"],
                row["3 bottom 2"]
            ]));

            const yTrain2 = tf.tensor2d(selectedData.map(row => [
                row.Date,
                row.Month,
                row.Year
            ]));

            // สร้างโมเดล neural network 1
            const input1 = tf.input({ shape: [3] });
            const dense1 = tf.layers.dense({ units: 64, activation: 'relu' }).apply(input1);
            const dense2 = tf.layers.dense({ units: 32, activation: 'relu' }).apply(dense1);
            const output1 = tf.layers.dense({ units: 3 }).apply(dense2);
            const model1 = tf.model({ inputs: input1, outputs: output1 });

            // สร้างโมเดล neural network 2
            const input2 = tf.input({ shape: [4] });
            const dense3 = tf.layers.dense({ units: 64, activation: 'relu' }).apply(input2);
            const dense4 = tf.layers.dense({ units: 32, activation: 'relu' }).apply(dense3);
            const output2 = tf.layers.dense({ units: 3 }).apply(dense4);
            const model2 = tf.model({ inputs: input2, outputs: output2 });

            // รวมชั้นและคอมไพล์โมเดล 1
            model1.compile({ loss: 'meanSquaredError', optimizer: 'sgd' });

            // รวมชั้นและคอมไพล์โมเดล 2
            model2.compile({ loss: 'meanSquaredError', optimizer: 'sgd' });

            // ฝึกโมเดลด้วยข้อมูล 1
            model1.fit(xTrain1, yTrain1, { epochs: 100 }).then(() => {
                displayResult('Model 1 training completed');
            });

            // ฝึกโมเดลด้วยข้อมูล 2
            model2.fit(xTrain2, yTrain2, { epochs: 100 }).then(() => {
                displayResult('Model 2 training completed');
            });
        }

        // เมื่อไฟล์ CSV ถูกเลือกและอัปโหลด
        const fileInput = document.getElementById('csvFileInput');
        fileInput.addEventListener('change', processCSV);
    </script>
</body>
</html>
